{"version":3,"file":"index.js","sources":["../src/lib/util.js","../src/lib/babel.js","../src/lib/css-loader.js","../src/webpack.js","../src/rollup.js","../src/configure.js","../src/index.js"],"sourcesContent":["import fs from 'fs';\nimport path from 'path';\nimport chalk from 'chalk';\nimport { createCodeFrame } from 'simple-code-frame';\nimport { parseStackTrace } from 'errorstacks';\n\nconst cwd = process.cwd();\nexport const res = (file) => path.resolve(cwd, file);\n\nexport function moduleDir(name) {\n\tlet file = require.resolve(name),\n\t\tfind = `${path.sep}node_modules${path.sep}${name}`,\n\t\tindex = file.indexOf(find);\n\treturn file.substring(0, index + find.length);\n}\n\nexport function fileExists(file) {\n\ttry {\n\t\treturn fs.statSync(file).isFile();\n\t} catch (e) {}\n\treturn false;\n}\n\nexport function readFile(file) {\n\ttry {\n\t\treturn fs.readFileSync(file, 'utf8');\n\t} catch (e) {}\n}\n\nexport function readDir(file) {\n\ttry {\n\t\treturn fs.readdirSync(file);\n\t} catch (e) {}\n}\n\nexport function tryRequire(file) {\n\tif (fileExists(file)) return require(file);\n}\n\nexport function dedupe(value, index, arr) {\n\treturn arr.indexOf(value) === index;\n}\n\nexport function indent(str, level) {\n\tconst space = ' '.repeat(level);\n\treturn str\n\t\t.split('\\n')\n\t\t.map((line) => space + line)\n\t\t.join('\\n');\n}\n\n/**\n * Colorize a pre-formatted code frame\n * @param {string} str\n */\nexport function highlightCodeFrame(str) {\n\treturn str\n\t\t.split('\\n')\n\t\t.map((line) => {\n\t\t\tif (/^>\\s(.*)/.test(line)) {\n\t\t\t\treturn line.replace(/^>(.*)/, (_, content) => {\n\t\t\t\t\treturn chalk.bold.redBright('>') + chalk.white(content);\n\t\t\t\t});\n\t\t\t} else if (/^\\s+\\|\\s+\\^/.test(line)) {\n\t\t\t\treturn line\n\t\t\t\t\t.replace('|', chalk.dim('|'))\n\t\t\t\t\t.replace('^', chalk.bold.redBright('^'));\n\t\t\t}\n\t\t\treturn chalk.dim(line);\n\t\t})\n\t\t.join('\\n');\n}\n\nexport function cleanStack(str, cwd = process.cwd()) {\n\tstr = str.replace(/^[\\s\\S]+\\n\\n([A-Za-z]*Error: )/g, '$1');\n\n\tlet stack = str.replace(\n\t\tnew RegExp(\n\t\t\t`( |\\\\()(https?:\\\\/\\\\/localhost:\\\\d+\\\\/base\\\\/|webpack:///|${cwd.replace(\n\t\t\t\t/([\\\\/[\\]()*+$!^.,?])/g,\n\t\t\t\t'\\\\$1'\n\t\t\t)}\\\\/*)?([^\\\\s():?]*?)(?:\\\\?[a-zA-Z0-9]+?)?(:\\\\d+(?::\\\\d+)?)`,\n\t\t\t'g'\n\t\t),\n\t\treplacer\n\t);\n\n\tlet frames = parseStackTrace(stack);\n\n\t// Some frameworks mess with the stack. Use a simple heuristic\n\t// to find the beginning of the proper stack.\n\tlet message = stack;\n\tif (frames.length) {\n\t\tlet lines = stack.split('\\n');\n\t\tlet stackStart = lines.indexOf(frames[0].raw);\n\t\tif (stackStart > 0) {\n\t\t\tmessage = lines\n\t\t\t\t.slice(0, stackStart)\n\t\t\t\t.map((s) => s.trim())\n\t\t\t\t.join('\\n');\n\t\t}\n\t}\n\n\t/**\n\t * The nearest location where the user's code triggered the error.\n\t * @type {import('errorstacks').StackFrame}\n\t */\n\tlet nearestFrame;\n\n\tstack = frames\n\t\t.filter((frame) => frame.type !== 'native' || frame.name !== 'Jasmine')\n\t\t.map((frame) => {\n\t\t\t// Only show frame for errors in the user's code\n\t\t\tif (\n\t\t\t\t!nearestFrame &&\n\t\t\t\t!/node_modules/.test(frame.fileName) &&\n\t\t\t\tframe.type !== 'native'\n\t\t\t) {\n\t\t\t\tnearestFrame = frame;\n\t\t\t}\n\n\t\t\t// Native traces don't have an error location\n\t\t\tif (!frame.name || frame.type === 'native') {\n\t\t\t\treturn chalk.gray(frame.raw.trim());\n\t\t\t}\n\n\t\t\tconst {\n\t\t\t\tsourceFileName,\n\t\t\t\tcolumn,\n\t\t\t\tfileName,\n\t\t\t\tline,\n\t\t\t\tname,\n\t\t\t\tsourceColumn,\n\t\t\t\tsourceLine,\n\t\t\t} = frame;\n\n\t\t\tconst loc = chalk.cyanBright(`${fileName}:${line}:${column}`);\n\t\t\tconst originalLoc =\n\t\t\t\tsourceFileName !== ''\n\t\t\t\t\t? chalk.gray(' <- ') +\n\t\t\t\t\t  chalk.gray(`${sourceFileName}:${sourceLine}:${sourceColumn}`)\n\t\t\t\t\t: '';\n\t\t\treturn chalk.gray(`at ${name} (${loc}${originalLoc})`);\n\t\t})\n\t\t.join('\\n');\n\n\tlet codeFrame = '';\n\tif (nearestFrame) {\n\t\ttry {\n\t\t\tconst { fileName, line, column } = nearestFrame;\n\t\t\tif (fileName) {\n\t\t\t\tconst content = fs.readFileSync(fileName, 'utf-8');\n\t\t\t\tcodeFrame = createCodeFrame(content, line - 1, column - 1, {\n\t\t\t\t\tbefore: 2,\n\t\t\t\t\tafter: 2,\n\t\t\t\t});\n\t\t\t\tcodeFrame = highlightCodeFrame(codeFrame);\n\t\t\t\tcodeFrame = indent(codeFrame, 2) + '\\n';\n\t\t\t}\n\t\t} catch (err) {\n\t\t\t// eslint-disable-next-line no-console\n\t\t\tconsole.log('INTERNAL WARNING: Failed to read stack frame code: ' + err);\n\t\t}\n\t}\n\n\tmessage = indent(chalk.reset(message), 2);\n\treturn `\\n${message}\\n\\n${codeFrame}${indent(stack, 4)}\\n`;\n}\n\nfunction replacer(str, before, root, filename, position) {\n\treturn before + './' + filename + position;\n}\n","/**\n * @param {import('../configure').Options} options\n */\nexport function babelConfig(options) {\n\treturn {\n\t\tpresets: [\n\t\t\t[\n\t\t\t\trequire.resolve('@babel/preset-env'),\n\t\t\t\t{\n\t\t\t\t\ttargets: {\n\t\t\t\t\t\tbrowsers: [\n\t\t\t\t\t\t\t'last 2 Chrome versions',\n\t\t\t\t\t\t\t'last 2 Firefox versions',\n\t\t\t\t\t\t\t(options.downlevel ||\n\t\t\t\t\t\t\t\t(options.browsers &&\n\t\t\t\t\t\t\t\t\tString(options.browsers).match(\n\t\t\t\t\t\t\t\t\t\t/(\\b|ms|microsoft)(ie|internet.explorer|edge)/gi\n\t\t\t\t\t\t\t\t\t))) &&\n\t\t\t\t\t\t\t\t'ie>=9',\n\t\t\t\t\t\t].filter(Boolean),\n\t\t\t\t\t},\n\t\t\t\t\tcorejs: 3,\n\t\t\t\t\tuseBuiltIns: 'usage',\n\t\t\t\t\tmodules: false,\n\t\t\t\t\tloose: true,\n\t\t\t\t},\n\t\t\t],\n\t\t],\n\t\tplugins: [\n\t\t\t[\n\t\t\t\trequire.resolve('@babel/plugin-transform-react-jsx'),\n\t\t\t\t{\n\t\t\t\t\tpragma: options.pragma || 'h',\n\t\t\t\t},\n\t\t\t],\n\t\t].concat(\n\t\t\toptions.coverage ? [require.resolve('babel-plugin-istanbul')] : []\n\t\t),\n\t};\n}\n\n/**\n * @param {import('../configure').Options} options\n */\nexport function babelLoader(options) {\n\treturn {\n\t\ttest: /\\.jsx?$/,\n\t\texclude: /node_modules/,\n\t\tloader: require.resolve('babel-loader'),\n\t\tquery: babelConfig(options),\n\t};\n}\n","export default function cssLoader(options) {\n\treturn {\n\t\ttest: /\\.css$/,\n\t\tloader: 'style-loader!css-loader',\n\t};\n}\n","import path from 'path';\nimport delve from 'dlv';\nimport { res, tryRequire, dedupe } from './lib/util';\nimport { babelLoader } from './lib/babel';\nimport cssLoader from './lib/css-loader';\n\n/**\n * @param {import('./configure').Options} options\n * @returns {boolean}\n */\nexport function shouldUseWebpack(options) {\n\tlet shouldUse = true;\n\ttry {\n\t\trequire('webpack');\n\t} catch (error) {\n\t\tshouldUse = false;\n\t}\n\n\treturn shouldUse;\n}\n\n/**\n * @param {Object} karmaConfig\n * @param {Object} pkg\n * @param {import('./configure').Options} options\n */\nexport function addWebpackConfig(karmaConfig, pkg, options) {\n\tconst WEBPACK_VERSION = String(require('webpack').version || '3.0.0');\n\tconst WEBPACK_MAJOR = parseInt(WEBPACK_VERSION.split('.')[0], 10);\n\n\tconst WEBPACK_CONFIGS = ['webpack.config.babel.js', 'webpack.config.js'];\n\n\tlet webpackConfig = options.webpackConfig;\n\n\tif (pkg.scripts) {\n\t\tfor (let i in pkg.scripts) {\n\t\t\tlet script = pkg.scripts[i];\n\t\t\tif (/\\bwebpack\\b[^&|]*(-c|--config)\\b/.test(script)) {\n\t\t\t\tlet matches = script.match(\n\t\t\t\t\t/(?:-c|--config)\\s+(?:([^\\s])|([\"'])(.*?)\\2)/\n\t\t\t\t);\n\t\t\t\tlet configFile = matches && (matches[1] || matches[2]);\n\t\t\t\tif (configFile) WEBPACK_CONFIGS.push(configFile);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (!webpackConfig) {\n\t\tfor (let i = WEBPACK_CONFIGS.length; i--; ) {\n\t\t\twebpackConfig = tryRequire(res(WEBPACK_CONFIGS[i]));\n\t\t\tif (webpackConfig) break;\n\t\t}\n\t}\n\n\tif (typeof webpackConfig === 'function') {\n\t\twebpackConfig = webpackConfig(\n\t\t\t{ karmatic: true },\n\t\t\t{ mode: 'development', karmatic: true }\n\t\t);\n\t}\n\twebpackConfig = webpackConfig || {};\n\n\tlet loaders = [].concat(\n\t\tdelve(webpackConfig, 'module.loaders') || [],\n\t\tdelve(webpackConfig, 'module.rules') || []\n\t);\n\n\tfunction evaluateCondition(condition, filename, expected) {\n\t\tif (typeof condition === 'function') {\n\t\t\treturn condition(filename) == expected;\n\t\t} else if (condition instanceof RegExp) {\n\t\t\treturn condition.test(filename) == expected;\n\t\t}\n\t\tif (Array.isArray(condition)) {\n\t\t\tfor (let i = 0; i < condition.length; i++) {\n\t\t\t\tif (evaluateCondition(condition[i], filename)) return expected;\n\t\t\t}\n\t\t}\n\t\treturn !expected;\n\t}\n\n\tfunction getLoader(predicate) {\n\t\tif (typeof predicate === 'string') {\n\t\t\tlet filename = predicate;\n\t\t\tpredicate = (loader) => {\n\t\t\t\tlet { test, include, exclude } = loader;\n\t\t\t\tif (exclude && evaluateCondition(exclude, filename, false))\n\t\t\t\t\treturn false;\n\t\t\t\tif (include && !evaluateCondition(include, filename, true))\n\t\t\t\t\treturn false;\n\t\t\t\tif (test && evaluateCondition(test, filename, true)) return true;\n\t\t\t\treturn false;\n\t\t\t};\n\t\t}\n\t\tfor (let i = 0; i < loaders.length; i++) {\n\t\t\tif (predicate(loaders[i])) {\n\t\t\t\treturn { index: i, loader: loaders[i] };\n\t\t\t}\n\t\t}\n\t\treturn false;\n\t}\n\n\tfunction webpackProp(name, value) {\n\t\tlet configured = delve(webpackConfig, name);\n\t\tif (Array.isArray(value)) {\n\t\t\treturn value.concat(configured || []).filter(dedupe);\n\t\t}\n\t\treturn Object.assign({}, configured || {}, value);\n\t}\n\n\tfor (let prop of Object.keys(karmaConfig.preprocessors)) {\n\t\tkarmaConfig.preprocessors[prop].unshift('webpack');\n\t}\n\n\tkarmaConfig.plugins.push(require.resolve('karma-webpack'));\n\n\tkarmaConfig.webpack = {\n\t\tdevtool: 'inline-source-map',\n\t\t// devtool: 'module-source-map',\n\t\tmode: webpackConfig.mode || 'development',\n\t\tmodule: {\n\t\t\t// @TODO check webpack version and use loaders VS rules as the key here appropriately:\n\t\t\t//\n\t\t\t// TODO: Consider adding coverage as a separate babel-loader so that\n\t\t\t// regardless if the user provides their own babel plugins, coverage still\n\t\t\t// works\n\t\t\trules: loaders\n\t\t\t\t.concat(\n\t\t\t\t\t!getLoader((rule) =>\n\t\t\t\t\t\t`${rule.use},${rule.loader}`.match(/\\bbabel-loader\\b/)\n\t\t\t\t\t)\n\t\t\t\t\t\t? babelLoader(options)\n\t\t\t\t\t\t: false,\n\t\t\t\t\t!getLoader('foo.css') && cssLoader(options)\n\t\t\t\t)\n\t\t\t\t.filter(Boolean),\n\t\t},\n\t\tresolve: webpackProp('resolve', {\n\t\t\tmodules: webpackProp('resolve.modules', [\n\t\t\t\t'node_modules',\n\t\t\t\tpath.resolve(__dirname, '../node_modules'),\n\t\t\t]),\n\t\t\talias: webpackProp('resolve.alias', {\n\t\t\t\t[pkg.name]: res('.'),\n\t\t\t\tsrc: res('src'),\n\t\t\t}),\n\t\t}),\n\t\tresolveLoader: webpackProp('resolveLoader', {\n\t\t\tmodules: webpackProp('resolveLoader.modules', [\n\t\t\t\t'node_modules',\n\t\t\t\tpath.resolve(__dirname, '../node_modules'),\n\t\t\t]),\n\t\t\talias: webpackProp('resolveLoader.alias', {\n\t\t\t\t[pkg.name]: res('.'),\n\t\t\t\tsrc: res('src'),\n\t\t\t}),\n\t\t}),\n\t\tplugins: (webpackConfig.plugins || []).filter((plugin) => {\n\t\t\tlet name = plugin && plugin.constructor.name;\n\t\t\treturn /^\\s*(UglifyJS|HTML|ExtractText|BabelMinify)(.*Webpack)?Plugin\\s*$/gi.test(\n\t\t\t\tname\n\t\t\t);\n\t\t}),\n\t\tnode: webpackProp('node', {}),\n\t\tperformance: {\n\t\t\thints: false,\n\t\t},\n\t};\n\n\tkarmaConfig.webpackMiddleware = {\n\t\tnoInfo: true,\n\t\tlogLevel: 'error',\n\t\tstats: 'errors-only',\n\t};\n\n\tif (WEBPACK_MAJOR < 4) {\n\t\tdelete karmaConfig.webpack.mode;\n\t\tlet { rules } = karmaConfig.webpack.module;\n\t\tdelete karmaConfig.webpack.module.rules;\n\t\tkarmaConfig.webpack.module.loaders = rules;\n\t}\n\n\treturn karmaConfig;\n}\n","import { babelConfig } from './lib/babel';\nimport { res, fileExists } from './lib/util';\n\n/**\n * @param {import('./configure').Options} options\n */\nfunction getDefaultConfig(options) {\n\tlet babel = require('@rollup/plugin-babel').default;\n\tlet commonjs = require('@rollup/plugin-commonjs');\n\tlet nodeResolve = require('@rollup/plugin-node-resolve').default;\n\n\treturn {\n\t\toutput: {\n\t\t\tformat: 'iife',\n\t\t\tname: `KarmaticTests`,\n\t\t\tsourcemap: 'inline',\n\t\t},\n\t\tplugins: [\n\t\t\tbabel({\n\t\t\t\tbabelHelpers: 'bundled',\n\t\t\t\t...babelConfig(options),\n\t\t\t}),\n\t\t\tnodeResolve(),\n\t\t\tcommonjs(),\n\t\t],\n\t};\n}\n\n/**\n * @param {Object} pkg\n * @param {import('./configure').Options} options\n */\nasync function getRollupConfig(pkg, options) {\n\tconst ROLLUP_CONFIGS = [\n\t\t'rollup.config.mjs',\n\t\t'rollup.config.cjs',\n\t\t'rollup.config.js',\n\t];\n\n\tlet rollupConfig = options.rollupConfig;\n\n\tif (pkg.scripts) {\n\t\tfor (let i in pkg.scripts) {\n\t\t\tlet script = pkg.scripts[i];\n\t\t\tif (/\\brollup\\b[^&|]*(-c|--config)\\b/.test(script)) {\n\t\t\t\tlet matches = script.match(\n\t\t\t\t\t/(?:-c|--config)\\s+(?:([^\\s])|([\"'])(.*?)\\2)/\n\t\t\t\t);\n\t\t\t\tlet configFile = matches && (matches[1] || matches[2]);\n\t\t\t\tif (configFile) ROLLUP_CONFIGS.push(configFile);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (!rollupConfig) {\n\t\tfor (let i = ROLLUP_CONFIGS.length; i--; ) {\n\t\t\tlet possiblePath = res(ROLLUP_CONFIGS[i]);\n\t\t\tif (fileExists(possiblePath)) {\n\t\t\t\t// Require Rollup 2.3.0 for this export: https://github.com/rollup/rollup/blob/master/CHANGELOG.md#230\n\t\t\t\tlet loadConfigFile = require('rollup/dist/loadConfigFile');\n\t\t\t\tlet rollupConfigResult = await loadConfigFile(possiblePath);\n\t\t\t\trollupConfigResult.warnings.flush();\n\n\t\t\t\tif (rollupConfigResult.options.length > 1) {\n\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t'Rollup config returns an array configs. Using the first one for tests'\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\trollupConfig = rollupConfigResult.options[0];\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (rollupConfig) {\n\t\tlet babel = require('@rollup/plugin-babel').default;\n\t\trollupConfig.plugins = (rollupConfig.plugins || []).concat([\n\t\t\tbabel({\n\t\t\t\tbabelHelpers: 'bundled',\n\t\t\t\tplugins: [require.resolve('babel-plugin-istanbul')],\n\t\t\t}),\n\t\t]);\n\n\t\treturn rollupConfig;\n\t}\n\n\treturn getDefaultConfig(options);\n}\n\n/**\n * @param {Object} karmaConfig\n * @param {Object} pkg\n * @param {import('./configure').Options} options\n */\nexport async function addRollupConfig(karmaConfig, pkg, options) {\n\t// From karma-rollup-preprocessor readme:\n\t// Make sure to disable Karma’s file watcher\n\t// because the preprocessor will use its own.\n\tfor (let i = 0; i < karmaConfig.files; i++) {\n\t\tlet entry = karmaConfig.files[i];\n\t\tif (typeof entry == 'string') {\n\t\t\tkarmaConfig.files[i] = { pattern: entry, watched: false };\n\t\t} else {\n\t\t\tkarmaConfig.files[i].watched = false;\n\t\t}\n\t}\n\n\tfor (let prop of Object.keys(karmaConfig.preprocessors)) {\n\t\tkarmaConfig.preprocessors[prop].unshift('rollup');\n\t}\n\n\tkarmaConfig.plugins.push(require.resolve('karma-rollup-preprocessor'));\n\n\tkarmaConfig.rollupPreprocessor = await getRollupConfig(pkg, options);\n}\n","import path from 'path';\nimport puppeteer from 'puppeteer';\nimport chalk from 'chalk';\nimport { tryRequire, cleanStack, readFile, readDir } from './lib/util';\nimport { shouldUseWebpack, addWebpackConfig } from './webpack';\nimport { addRollupConfig } from './rollup';\n\n/**\n * @typedef Options\n * @property {Array} files - Test files to run\n * @property {Array} [browsers] - Custom list of browsers to run in\n * @property {Boolean} [headless=false] - Run in Headless Chrome?\n * @property {Boolean} [watch=false] - Start a continuous test server and retest when files change\n * @property {Boolean} [coverage=false] - Instrument and collect code coverage statistics\n * @property {Object} [webpackConfig] - Custom webpack configuration\n * @property {Object} [rollupConfig] - Custom rollup configuration\n * @property {string} [pragma] - JSX pragma to compile JSX with\n * @property {Boolean} [downlevel=false] - Downlevel/transpile syntax to ES5\n * @property {string} [chromeDataDir] - Use a custom Chrome profile directory\n *\n * @param {Options} options\n */\nexport default async function configure(options) {\n\tlet cwd = process.cwd(),\n\t\tres = (file) => path.resolve(cwd, file);\n\n\tlet files = options.files.filter(Boolean);\n\tif (!files.length) files = ['**/{*.test.js,*_test.js}'];\n\n\tprocess.env.CHROME_BIN = puppeteer.executablePath();\n\n\tlet gitignore = (readFile(path.resolve(cwd, '.gitignore')) || '')\n\t\t.replace(/(^\\s*|\\s*$|#.*$)/g, '')\n\t\t.split('\\n')\n\t\t.filter(Boolean);\n\tlet repoRoot = (readDir(cwd) || []).filter(\n\t\t(c) => c[0] !== '.' && c !== 'node_modules' && gitignore.indexOf(c) === -1\n\t);\n\tlet rootFiles = '{' + repoRoot.join(',') + '}';\n\n\tconst PLUGINS = [\n\t\t'karma-chrome-launcher',\n\t\t'karma-jasmine',\n\t\t'karma-spec-reporter',\n\t\t'karma-min-reporter',\n\t\t'karma-sourcemap-loader',\n\t].concat(options.coverage ? 'karma-coverage' : []);\n\n\tconst preprocessors = ['sourcemap'];\n\n\t// Custom launchers to be injected:\n\tconst launchers = {};\n\tlet useSauceLabs = false;\n\n\tlet browsers;\n\tif (options.browsers) {\n\t\tbrowsers = options.browsers.map((browser) => {\n\t\t\tif (/^chrome([ :-]?headless)?$/i.test(browser)) {\n\t\t\t\treturn `KarmaticChrome${/headless/i.test(browser) ? 'Headless' : ''}`;\n\t\t\t}\n\t\t\tif (/^firefox$/i.test(browser)) {\n\t\t\t\tPLUGINS.push('karma-firefox-launcher');\n\t\t\t\treturn 'Firefox';\n\t\t\t}\n\t\t\tif (/^sauce-/.test(browser)) {\n\t\t\t\tif (!useSauceLabs) {\n\t\t\t\t\tuseSauceLabs = true;\n\t\t\t\t\tPLUGINS.push('karma-sauce-launcher');\n\t\t\t\t}\n\t\t\t\tconst parts = browser.toLowerCase().split('-');\n\t\t\t\tconst name = parts.join('_');\n\t\t\t\tlaunchers[name] = {\n\t\t\t\t\tbase: 'SauceLabs',\n\t\t\t\t\tbrowserName: parts[1]\n\t\t\t\t\t\t.replace(/^(msie|ie|internet ?explorer)$/i, 'Internet Explorer')\n\t\t\t\t\t\t.replace(/^(ms|microsoft|)edge$/i, 'MicrosoftEdge'),\n\t\t\t\t\tversion: parts[2] || undefined,\n\t\t\t\t\tplatform: parts[3]\n\t\t\t\t\t\t? parts[3]\n\t\t\t\t\t\t\t\t.replace(/^win(dows)?[ -]+/gi, 'Windows ')\n\t\t\t\t\t\t\t\t.replace(/^(macos|mac ?os ?x|os ?x)[ -]+/gi, 'OS X ')\n\t\t\t\t\t\t: undefined,\n\t\t\t\t};\n\t\t\t\treturn name;\n\t\t\t}\n\t\t\treturn browser;\n\t\t});\n\t} else {\n\t\tbrowsers = [\n\t\t\toptions.headless === false ? 'KarmaticChrome' : 'KarmaticChromeHeadless',\n\t\t];\n\t}\n\n\tif (useSauceLabs) {\n\t\tlet missing = ['SAUCE_USERNAME', 'SAUCE_ACCESS_KEY'].filter(\n\t\t\t(x) => !process.env[x]\n\t\t)[0];\n\t\tif (missing) {\n\t\t\tthrow '\\n' +\n\t\t\t\tchalk.bold.bgRed.white('Error:') +\n\t\t\t\t' Missing SauceLabs auth configuration.' +\n\t\t\t\t'\\n  ' +\n\t\t\t\tchalk.white(\n\t\t\t\t\t`A SauceLabs browser was requested, but no ${chalk.magentaBright(\n\t\t\t\t\t\tmissing\n\t\t\t\t\t)} environment variable provided.`\n\t\t\t\t) +\n\t\t\t\t'\\n  ' +\n\t\t\t\tchalk.white('Try prepending it to your test command:') +\n\t\t\t\t'  ' +\n\t\t\t\tchalk.greenBright(missing + '=... npm test') +\n\t\t\t\t'\\n';\n\t\t}\n\t}\n\n\tlet pkg = tryRequire(res('package.json'));\n\n\tconst chromeDataDir = options.chromeDataDir\n\t\t? path.resolve(cwd, options.chromeDataDir)\n\t\t: null;\n\n\tconst flags = ['--no-sandbox'];\n\n\tlet generatedConfig = {\n\t\tbasePath: cwd,\n\t\tplugins: PLUGINS.map((req) => require.resolve(req)),\n\t\tframeworks: ['jasmine'],\n\t\tbrowserNoActivityTimeout: options.inactivityTimeout,\n\t\treporters: [options.watch ? 'min' : 'spec'].concat(\n\t\t\toptions.coverage ? 'coverage' : [],\n\t\t\tuseSauceLabs ? 'saucelabs' : []\n\t\t),\n\t\tbrowsers,\n\t\tsauceLabs: {\n\t\t\ttestName: (pkg && pkg.name) || undefined,\n\t\t},\n\n\t\tcustomLaunchers: Object.assign(\n\t\t\t{\n\t\t\t\tKarmaticChrome: {\n\t\t\t\t\tbase: 'Chrome',\n\t\t\t\t\tchromeDataDir,\n\t\t\t\t\tflags,\n\t\t\t\t},\n\t\t\t\tKarmaticChromeHeadless: {\n\t\t\t\t\tbase: 'ChromeHeadless',\n\t\t\t\t\tchromeDataDir,\n\t\t\t\t\tflags,\n\t\t\t\t},\n\t\t\t},\n\t\t\tlaunchers\n\t\t),\n\n\t\tcoverageReporter: {\n\t\t\treporters: [\n\t\t\t\t{ type: 'text-summary' },\n\t\t\t\t{ type: 'html' },\n\t\t\t\t{ type: 'lcovonly', subdir: '.', file: 'lcov.info' },\n\t\t\t],\n\t\t},\n\n\t\tformatError(msg) {\n\t\t\ttry {\n\t\t\t\tmsg = JSON.parse(msg).message;\n\t\t\t} catch (e) {}\n\t\t\treturn cleanStack(msg);\n\t\t},\n\n\t\tlogLevel: 'ERROR',\n\n\t\tloggers: [\n\t\t\t{\n\t\t\t\ttype: path.resolve(__dirname, 'appender.js'),\n\t\t\t},\n\t\t],\n\n\t\tfiles: [\n\t\t\t// Inject Jest matchers:\n\t\t\t{\n\t\t\t\tpattern: path.resolve(\n\t\t\t\t\t__dirname,\n\t\t\t\t\t'../node_modules/expect/build-es5/index.js'\n\t\t\t\t),\n\t\t\t\twatched: false,\n\t\t\t\tincluded: true,\n\t\t\t\tserved: true,\n\t\t\t},\n\t\t].concat(\n\t\t\t...files.map((pattern) => {\n\t\t\t\t// Expand '**/xx' patterns but exempt node_modules and gitignored directories\n\t\t\t\tlet matches = pattern.match(/^\\*\\*\\/(.+)$/);\n\t\t\t\tif (!matches)\n\t\t\t\t\treturn { pattern, watched: true, served: true, included: true };\n\t\t\t\treturn [\n\t\t\t\t\t{\n\t\t\t\t\t\tpattern: rootFiles + '/' + matches[0],\n\t\t\t\t\t\twatched: true,\n\t\t\t\t\t\tserved: true,\n\t\t\t\t\t\tincluded: true,\n\t\t\t\t\t},\n\t\t\t\t\t{ pattern: matches[1], watched: true, served: true, included: true },\n\t\t\t\t];\n\t\t\t})\n\t\t),\n\n\t\tpreprocessors: {\n\t\t\t[rootFiles + '/**/*']: preprocessors,\n\t\t\t[rootFiles]: preprocessors,\n\t\t},\n\n\t\tcolors: true,\n\n\t\tclient: {\n\t\t\tcaptureConsole: true,\n\n\t\t\tjasmine: {\n\t\t\t\trandom: false,\n\t\t\t},\n\t\t},\n\t};\n\n\tif (shouldUseWebpack(options)) {\n\t\taddWebpackConfig(generatedConfig, pkg, options);\n\t} else {\n\t\tawait addRollupConfig(generatedConfig, pkg, options);\n\t}\n\n\treturn generatedConfig;\n}\n","import { Server } from 'karma';\nimport configure from './configure';\n\nexport default async function karmatic(options) {\n\tlet config = await configure(options);\n\n\tif (!options.watch) config.singleRun = true;\n\n\tlet server = createServer(config);\n\n\tserver.start();\n\n\treturn await server.completion;\n}\n\nfunction createServer(config) {\n\tlet resolve, reject;\n\n\tlet promise = new Promise((res, rej) => {\n\t\tresolve = res;\n\t\treject = rej;\n\t});\n\n\tlet callback = (code) => {\n\t\tif (code === 0) return resolve();\n\t\tlet err = Error(`Exit ${code}`);\n\t\terr.code = code;\n\t\treject(err);\n\t};\n\n\tlet server = new Server(config, callback);\n\n\tserver.completion = promise;\n\treturn server;\n}\n"],"names":["cwd","process","res","file","path","resolve","fileExists","fs","statSync","isFile","e","readFile","readFileSync","readDir","readdirSync","tryRequire","require","dedupe","value","index","arr","indexOf","indent","str","level","space","repeat","split","map","line","join","highlightCodeFrame","test","replace","_","content","chalk","bold","redBright","white","dim","cleanStack","stack","RegExp","replacer","frames","parseStackTrace","message","length","lines","stackStart","raw","slice","s","trim","nearestFrame","filter","frame","type","name","fileName","gray","sourceFileName","column","sourceColumn","sourceLine","loc","cyanBright","originalLoc","codeFrame","createCodeFrame","before","after","err","console","log","reset","root","filename","position","babelConfig","options","presets","targets","browsers","downlevel","String","match","Boolean","corejs","useBuiltIns","modules","loose","plugins","pragma","concat","coverage","babelLoader","exclude","loader","query","cssLoader","shouldUseWebpack","shouldUse","error","addWebpackConfig","karmaConfig","pkg","WEBPACK_VERSION","version","WEBPACK_MAJOR","parseInt","WEBPACK_CONFIGS","webpackConfig","scripts","i","script","matches","configFile","push","karmatic","mode","loaders","delve","evaluateCondition","condition","expected","Array","isArray","getLoader","predicate","include","webpackProp","configured","Object","assign","prop","keys","preprocessors","unshift","webpack","devtool","module","rules","rule","use","__dirname","alias","src","resolveLoader","plugin","constructor","node","performance","hints","webpackMiddleware","noInfo","logLevel","stats","getDefaultConfig","babel","default","commonjs","nodeResolve","output","format","sourcemap","babelHelpers","getRollupConfig","ROLLUP_CONFIGS","rollupConfig","possiblePath","loadConfigFile","rollupConfigResult","warnings","flush","addRollupConfig","files","entry","pattern","watched","rollupPreprocessor","configure","env","CHROME_BIN","puppeteer","executablePath","gitignore","repoRoot","c","rootFiles","PLUGINS","launchers","useSauceLabs","browser","parts","toLowerCase","base","browserName","undefined","platform","headless","missing","x","bgRed","magentaBright","greenBright","chromeDataDir","flags","generatedConfig","basePath","req","frameworks","browserNoActivityTimeout","inactivityTimeout","reporters","watch","sauceLabs","testName","customLaunchers","KarmaticChrome","KarmaticChromeHeadless","coverageReporter","subdir","formatError","msg","JSON","parse","loggers","included","served","colors","client","captureConsole","jasmine","random","config","singleRun","server","createServer","start","completion","reject","promise","Promise","rej","callback","code","Error","Server"],"mappings":"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"}